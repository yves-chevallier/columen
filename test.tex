\documentclass{exam}

\usepackage{parskip}
\usepackage{multicol}
\usepackage{xparse}
\usepackage{etoolbox}

\makeatletter
\newif\ifWI@pending
\newif\ifWI@broke
\newif\ifWI@rerun
\newif\ifWI@usemulticols
\newif\ifWI@locked
\newif\ifWI@star
\WI@rerunfalse

\newcount\WI@columncount
\newcount\WI@nextcolumns
\newcount\WI@maxcolumns
\newcount\WI@listcounter
\WI@listcounter=0\relax

\newcommand\WI@defaultmaxcols{5}

\newif\ifWI@columnspread
\newif\ifWI@columnspreadstar
\newif\ifWI@columnspreadhaskey
\newcount\WI@columnspreaddepth
\newcount\WI@columnspreadlistcount
\WI@columnspreadfalse
\WI@columnspreadstarfalse
\WI@columnspreadhaskeyfalse
\WI@columnspreaddepth=0\relax
\WI@columnspreadlistcount=0\relax
\newcommand\WI@columnspreadcols{\WI@defaultmaxcols}
\newcommand\WI@columnspreadkey{}

\newcommand\WI@getcols[1]{%
  \@ifundefined{WI@cols@#1}{1}{\csname WI@cols@#1\endcsname}%
}

\newcommand\WI@definecols[2]{%
  \expandafter\gdef\csname WI@cols@#1\endcsname{#2}%
}

\newcommand\WI@writecols[2]{%
  \begingroup
    \edef\WI@tempa{\string\WI@definecols{#1}{#2}}%
    \protected@write\@auxout{}{\WI@tempa}%
  \endgroup
}

\newcommand\WI@getlock[1]{%
  \@ifundefined{WI@lock@#1}{0}{\csname WI@lock@#1\endcsname}%
}

\newcommand\WI@definelock[2]{%
  \expandafter\gdef\csname WI@lock@#1\endcsname{#2}%
}

\newcommand\WI@writelock[2]{%
  \begingroup
    \edef\WI@tempb{\string\WI@definelock{#1}{#2}}%
    \protected@write\@auxout{}{\WI@tempb}%
  \endgroup
}

\newcommand\WI@generatekey{%
  \global\advance\WI@listcounter\@ne
  \edef\WI@currentkey{auto-\the\WI@listcounter}%
}

\newif\ifWI@active
\WI@activefalse

\newcommand\WI@maybeWarn@[1]{%
  \ifnum#1>1
    \global\WI@broketrue
    \PackageWarning{columnspread}{A list item broke across #1 lines}%
  \fi
  \WI@pendingfalse
}

\newcommand\WI@checkpending{%
  \ifWI@active
    \ifWI@pending
      \expandafter\WI@maybeWarn@\expandafter{\the\prevgraf}%
    \fi
  \fi
}

\newcommand\WI@armpending{%
  \ifWI@active
    \WI@pendingtrue
  \fi
}

\AddToHook{para/after}{\WI@checkpending}
\AddToHook{cmd/item/before}{\WI@armpending}

\AtEndDocument{%
  \ifWI@rerun
    \PackageWarningNoLine{columnspread}{List columns expanded; rerun LaTeX}%
  \fi
}

\newcommand\WI@startcolumns[1]{%
    \global\WI@activetrue
    \global\WI@brokefalse
    \WI@pendingfalse
    \WI@maxcolumns=#1\relax
    \ifnum\WI@maxcolumns<1 \WI@maxcolumns=1\fi
    \WI@lockedfalse
    \WI@usemulticolstrue
    \ifWI@star
      \WI@columncount=\WI@maxcolumns
    \else
      \WI@columncount=\WI@getcols{\WI@currentkey}\relax
      \ifnum\WI@columncount<1 \WI@columncount=1\fi
      \ifnum\WI@columncount>\WI@maxcolumns
        \WI@columncount=\WI@maxcolumns
      \fi
      \ifnum\WI@getlock{\WI@currentkey}>0\relax
        \WI@lockedtrue
      \fi
    \fi
    \ifnum\WI@columncount=1
      \WI@usemulticolsfalse
    \fi
    \ifWI@usemulticols
      \ifWI@star
        \begin{multicols*}{\the\WI@columncount}%
      \else
        \begin{multicols}{\the\WI@columncount}%
      \fi
    \fi
}

\newcommand\WI@endcolumns{%
    \WI@checkpending
    \ifWI@usemulticols
      \ifWI@star
        \end{multicols*}%
      \else
        \end{multicols}%
      \fi
    \fi
    \ifWI@star
      % starred variant is manual; keep requested column count
    \else
      \WI@nextcolumns=\WI@columncount
      \ifWI@broke
        \ifnum\WI@columncount>1
          \advance\WI@nextcolumns\m@ne
          \WI@lockedtrue
        \fi
      \else
        \ifWI@locked
          % keep current column count
        \else
          \ifnum\WI@nextcolumns<\WI@maxcolumns
            \advance\WI@nextcolumns\@ne
            \global\WI@reruntrue
          \fi
        \fi
      \fi
      \ifnum\WI@nextcolumns<1 \WI@nextcolumns=1\fi
      \WI@writecols{\WI@currentkey}{\the\WI@nextcolumns}%
      \ifWI@locked
        \WI@writelock{\WI@currentkey}{1}%
      \else
        \WI@writelock{\WI@currentkey}{0}%
      \fi
    \fi
    \WI@starfalse
    \global\WI@activefalse
}

\newcommand\WI@columnspread@begin[2]{%
  \ifWI@columnspread
    \PackageError{columnspread}{Nested columnspread environments are unsupported}{%
      Close the surrounding columnspread environment before starting another.%
    }%
  \fi
  \WI@columnspreadtrue
  \WI@columnspreaddepth=0\relax
  \WI@columnspreadlistcount=0\relax
  \def\WI@columnspreadcols{#1}%
  \IfNoValueTF{#2}{%
    \WI@columnspreadhaskeyfalse
  }{%
    \WI@columnspreadhaskeytrue
    \def\WI@columnspreadkey{#2}%
  }%
}

\newcommand\WI@columnspread@end{%
  \ifWI@columnspread
    \ifnum\WI@columnspreaddepth>0\relax
      \WI@endcolumns
    \fi
    \WI@columnspreadfalse
    \WI@columnspreadstarfalse
    \WI@columnspreadhaskeyfalse
    \WI@columnspreaddepth=0\relax
    \WI@columnspreadlistcount=0\relax
  \fi
}

\newcommand\WI@columnspread@before{%
  \ifWI@columnspread
    \advance\WI@columnspreaddepth\@ne
    \ifnum\WI@columnspreaddepth=\@ne
      \advance\WI@columnspreadlistcount\@ne
      \ifWI@columnspreadhaskey
        \protected@edef\WI@currentkey{\WI@columnspreadkey-\the\WI@columnspreadlistcount}%
      \else
        \WI@generatekey
      \fi
      \ifWI@columnspreadstar
        \WI@startrue
      \else
        \WI@starfalse
      \fi
      \WI@startcolumns{\WI@columnspreadcols}%
    \fi
  \fi
}

\newcommand\WI@columnspread@after{%
  \ifWI@columnspread
    \ifnum\WI@columnspreaddepth>0\relax
      \ifnum\WI@columnspreaddepth=\@ne
        \WI@endcolumns
      \fi
      \advance\WI@columnspreaddepth\m@ne
    \fi
  \fi
}

\newcommand\WI@columnspread@patch[1]{%
  \BeforeBeginEnvironment{#1}{\WI@columnspread@before}%
  \AfterEndEnvironment{#1}{\WI@columnspread@after}%
}

\newcommand\WI@columnspread@maybe[1]{%
  \@ifundefined{#1}{}{%
    \WI@columnspread@patch{#1}%
  }%
}

\NewDocumentEnvironment{columnspread}{O{\WI@defaultmaxcols} o}
  {%
    \WI@columnspreadstarfalse
    \WI@columnspread@begin{#1}{#2}%
  }
  {\WI@columnspread@end}

\NewDocumentEnvironment{columnspread*}{O{\WI@defaultmaxcols} o}
  {%
    \WI@columnspreadstartrue
    \WI@columnspread@begin{#1}{#2}%
  }
  {\WI@columnspread@end}

\WI@columnspread@maybe{itemize}
\WI@columnspread@maybe{enumerate}
\WI@columnspread@maybe{checkboxes}

\makeatother

\begin{document}

\section{Automatic Spread Items Across Columns}

This demo shows how to automatically spread items across multiple columns,
in order to save space. If an item breaks across a page or column boundary,
the number of columns is reduced and the document must be recompiled to see
the effect.

The goal is to make this demo work with most itemize-like environments, including:

\begin{itemize}
\item itemize
\item enumerate
\item exam checkboxes
\end{itemize}

\section{Examples}

\subsection{Itemize}

With fairly short items, we can fit in more columns:

\begin{columnspread}[5]
\begin{itemize}
  \item Alpha
  \item Beta
  \item Gamma
  \item Delta
  \item Epsilon
  \item Zeta
  \item Eta
  \item Theta
  \item Iota
  \item Kappa
\end{itemize}
\end{columnspread}

With longer items, fewer columns are used to avoid breaking items:

\begin{columnspread}[5]
\begin{itemize}
    \item Odin Allfather
    \item Thor Thunderer
    \item Loki Trickster
    \item Freyja Vanir Goddess
    \item Tyr God of War
    \item Baldr Shining One
    \item Heimdall Watchman
    \item Njord Sea Deity
    \item Skadi Winter Huntress
    \item Hel Ruler of the Dead
\end{itemize}
\end{columnspread}

\subsection{Enumerate}

It also works with enumerate:

\begin{columnspread}[5]
\begin{enumerate}
  \item Alpha
  \item Beta
  \item Gamma
  \item Delta
  \item Epsilon
  \item Zeta
  \item Eta
  \item Theta
  \item Iota
  \item Kappa
\end{enumerate}
\end{columnspread}

Same demo with longer items:

\begin{columnspread}[5]
\begin{enumerate}
    \item Odin Allfather
    \item Thor Thunderer
    \item Loki Trickster
    \item Freyja Vanir Goddess
    \item Tyr God of War
    \item Baldr Shining One
    \item Heimdall Watchman
    \item Njord Sea Deity
    \item Skadi Winter Huntress
    \item Hel Ruler of the Dead
\end{enumerate}
\end{columnspread}

\subsection{Exam Checkboxes}

It also works with exam checkboxes:

\begin{questions}
\question Which animal is known as the "King of the Jungle"?

\begin{columnspread}[5]
\begin{checkboxes}
  \CorrectChoice Lion
  \choice Tiger
  \choice Elephant
  \choice Giraffe
  \choice Zebra
  \choice Cheetah
  \choice Gorilla
  \choice Hyena
  \choice Leopard
  \choice Rhino
\end{checkboxes}
\end{columnspread}

\end{questions}

\subsection{Descriptions}

This environment is not patched by default, but can be used manually:

\begin{columnspread}[3]
\begin{description}
  \item[Apple] A sweet red fruit.
  \item[Banana] A long yellow fruit.
  \item[Cherry] A small red fruit.
  \item[Date] A sweet brown fruit.
  \item[Elderberry] A small dark fruit.
  \item[Fig] A pear-shaped fruit.
  \item[Grape] A small round fruit.
  \item[Honeydew] A sweet green melon.
\end{description}
\end{columnspread}

\end{document}
